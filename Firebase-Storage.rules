rules_version = '2';
service firebase.storage {
match /b/{bucket}/o {

// ✅ User Avatars
match /avatars/{userId} {
  allow write: if request.auth != null &&
               request.auth.uid == userId &&
               request.resource.size > 0 &&
               request.resource.size < 1 * 1024 * 1024 &&
               request.resource.contentType.matches('image/.*');
  allow read: if true;
}

// ✅ User Banners
match /banners/{userId} {
  allow write: if request.auth != null &&
               request.auth.uid == userId &&
               request.resource.size > 0 &&
               request.resource.size < 2 * 1024 * 1024 &&
               request.resource.contentType.matches('image/.*');
  allow read: if true;
}

// ✅ Group Images (banner/logo)
match /groups/{groupId}/{fileName} {
  allow write: if request.auth != null &&
               request.resource.size > 0 &&
               request.resource.size < 1 * 1024 * 1024 &&
               request.resource.contentType.matches('image/.*');
  allow read: if true; // Public read
}

// ✅ Post Images (Home feed)
match /posts/{postId}/{fileName} {
  allow write: if request.auth != null &&
               request.resource.size > 0 &&
               request.resource.size < 1 * 1024 * 1024 &&
               request.resource.contentType.matches('image/.*');
  allow read: if true; // Public read
}

// ✅ Group Post Images (author or admin only)
match /groupPosts/{postId}/{fileName} {
  allow write: if request.auth != null &&
               request.resource.size > 0 &&
               request.resource.size < 1 * 1024 * 1024 &&
               request.resource.contentType.matches('image/.*');             
  allow read: if true; // Public read
}

// ✅ Default public read for all other files
match /{allPaths=**} {
  allow read: if true;
}
}
}